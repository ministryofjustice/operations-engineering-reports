{% extends "base.html" %}

{% block content %}

<h1 class="govuk-heading-l">
  {% if total_repos %}
    Public GitHub Repositories: ({{ total_repos }})
  {% else %} Public GitHub Repositories {% endif %}
  {% if updated_at %}
    <span class="govuk-caption-m">Updated: {{ updated_at }} UTC</span>
  {% endif %}
</h1>

<h2 class="govuk-heading-m">
  {% if number_compliant_repos %}
    Compliant: <a href="#compliant_repositories">{{ number_compliant_repos }}</a>
  {% else %}
    Compliant: N/A
  {% endif %}
</h2>

<h2 class="govuk-heading-m">
  {% if number_non_compliant_repos %}
    Non Compliant: <a href="#non_compliant_repositories">{{ number_non_compliant_repos }}</a>
  {% else %}
    Non Compliant: N/A
  {% endif %}
</h2>

<p class="govuk-body">This report lists public MoJ GitHub repositories which are and are not fully compliant with our organisation standards.</p>
<p class="govuk-body">This report is generated by the code in this <a href="https://github.com/ministryofjustice/github-repository-standards">repository</a></p>

{% if number_compliant_repos %}
  <table class="govuk-table">
    <caption class="govuk-table__caption govuk-table__caption--m" id="compliant_repositories">
      Compliant
    </caption>
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header">Name</th>
        <th scope="col" class="govuk-table__header">Last Push</th>
      </tr>
    </thead>
    <tbody class="govuk-table__body">
      {% for repo in compliant_repos %}
      <tr class="govuk-table__row">
        <th scope="row" class="govuk-table__header">
          <a class="govuk-breadcrumbs__link" href="{{repo.url}}"> {{repo.name}} </a>
        </th>
        <td class="govuk-table__cell">{{repo.last_push}}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %} 

{% if number_non_compliant_repos %}
  <table class="govuk-table">
    <caption class="govuk-table__caption govuk-table__caption--m" id="non_compliant_repositories">
      Non Compliant
    </caption>
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header">Name</th>
        <th scope="col" class="govuk-table__header">Last Push</th>
        <th scope="col" class="govuk-table__header">Reason</th>
      </tr>
    </thead>
    <tbody class="govuk-table__body">
      {% for repo in non_compliant_repos %}
        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header">
            <a class="govuk-breadcrumbs__link" href="{{repo.url}}"> {{repo.name}} </a>
          </th>
          <td class="govuk-table__cell">{{repo.last_push}}</td>
          <td class="govuk-table__cell">
            {% for failure in repo.fail_reasons %}
              <ul>
                <li class="govuk-list--bullet">{{failure}}</li>
              </ul>
            {% endfor %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}

{{ super() }}

{% endblock %}
