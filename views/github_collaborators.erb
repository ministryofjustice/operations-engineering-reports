<h1>GitHub Collaborators</h1>

<p>
  GitHub users with access to ministryofjustice repositories
  who are <b>not</b> members of the ministryofjustice
  GitHub organization.
</p>

<p>
  Report data generated by <a href="https://github.com/ministryofjustice/operations-engineering-github-collaborators#github-external-collaborators">this project</a>.
</p>

<% if data.list.any? %>

  <% if params["group_by"] == "login" %>

    <h2>Collaborators</h2>
    <p>
      <%= link_to "Group by repository", "?group_by=repository" %>
    </p>

    <div class="row">
      <% data.collaborators.each do |collab| %>
        <table class="table table-striped">
          <thead class="thead-dark">
            <tr>
              <th> <%= link_to collab.login, collab.login_url %> </th>
            </tr>
          </thead>
          <% data.collaborator_repositories(collab.login).each do |repo| %>
            <tr>
              <td> <%= link_to repo.repository, repo.repo_url %> </td>
            </tr>
          <% end %>
        </table>
      <% end %>
    </div>

  <% else %> <%# if params["group_by"] == "login" %>

    <h2>Repositories</h2>
    <p>
      <%= link_to "Group by collaborator", "?group_by=login" %>
    </p>

    <div class="row">
      <% data.repositories.each do |repo| %>
        <table class="table table-striped">
          <thead class="thead-dark">
            <tr>
              <th> <%= link_to repo.repository, repo.repo_url %> </th>
            </tr>
          </thead>
          <% data.repository_collaborators(repo.repository).each do |collab| %>
            <tr>
              <td> <%= link_to collab.login, collab.login_url %> </td>
            </tr>
          <% end %>
        </table>
      <% end %>
    </div>

  <% end %> <%# if params["group_by"] == "login" %>

<% else %> <%# if data.list.any? %>
  <h1>
    Awaiting data
  </h1>
<% end %> <%# if data.list.any? %>
