<% if updated_at.to_s == "" %>
  <h2>Awaiting data</h2>
<% else %>
  <% if data.list.any? %>
    <% total = " (#{data.list.size})" %>
  <% end %>
  <h1>MoJ Public GitHub Repositories: <%= total %></h1>
  <h2>Compliant: <a href="#compliant_div_id"><%= data.pass.count %> </a></h2>
  <h2>With compliance issues: <a href="#non_compliant_div_id"><%= data.failing.count %> </a></h2>

  <p>
    This report lists <b>public</b> MoJ GitHub repositories which are and are not
    fully compliant with our organisation standards.
  </p>

  <p>
    Report generated by the code in <a href="https://github.com/ministryofjustice/github-repository-standards">this repository</a>
  </p>

  <div class="row">
    <table id="compliant_div_id" class="table table-striped">
      <thead>
        <tr>
          <th>Repository</th>
        </tr>
      </thead>
      <tbody>
        <% data.pass.each do |repo| %>
          <tr>
            <td>
              <span class="badge bg-success bg-secondary">
                <a href="#<%= repo.name %>">&lt;/&gt;</a>
              </span>
              <span id="<%= repo.name %>"></span>
              <a href="<%= repo.url %>"><%= repo.name %></a><br />

              Last push: <%= repo.last_push %>
            </td>
          </tr>
        <% end %>
      </tbody>
  </div>

  <div class="row">
    <table id="non_compliant_div_id" class="table table-striped">
      <thead>
        <tr>
          <th>Repository</th>
          <th>Problems</th>
        </tr>
      </thead>
      <tbody>
        <% data.failing.each do |repo| %>
          <tr>
            <td>
              <span class="badge bg-dark bg-secondary">
                <a href="#<%= repo.name %>">&lt;/&gt;</a>
              </span>
              <span id="<%= repo.name %>"></span>
              <a href="<%= repo.url %>"><%= repo.name %></a><br />

              Last push: <%= repo.last_push %>
            </td>
            <td>
              <ul>
                <% repo.report.each do |key, value| %>
                  <% if !value %>
                    <li><%= repo.readable_problem(key) %></li>
                  <% end %>
                <% end %>
              </ul>
            </td>
          </tr>
        <% end %>
      </tbody>
  </div>
<% end %>
